## –ü–ª–∞–Ω: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã —Å–±–æ—Ä–∫–∏ –ø—Ä–æ–º–ø—Ç–æ–≤

### 1. –¶–µ–ª–∏ –∏ –∑–∞–¥–∞—á–∏

–û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî —Å–¥–µ–ª–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ –±–æ–ª–µ–µ –≥–∏–±–∫–∏–º, –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω—ã–º –∏ –º–æ—â–Ω—ã–º. –ú—ã –æ—Ç—Ö–æ–¥–∏–º –æ—Ç –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ –ø–æ–ª—å–∑—É –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–≥–æ –Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.

**–ö–ª—é—á–µ–≤—ã–µ –∑–∞–¥–∞—á–∏:**
1.  **–í–Ω–µ–¥—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:** –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –∏ –ª–æ–∫–∞–ª—å–Ω—ã–µ (—É—Ä–æ–≤–Ω—è –∞–≥–µ–Ω—Ç–∞) –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.
2.  **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–≤–∞ —Ä–µ–∂–∏–º–∞ —Å–±–æ—Ä–∫–∏:**
    *   **"–ü—Ä–æ—Å—Ç–æ–π —Å–±–æ—Ä—â–∏–∫" (`assembly`):** –î–ª—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π —Å–±–æ—Ä–∫–∏ –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤, —Ñ–∞–π–ª–æ–≤ –∏ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä–∞.
    *   **"–†–µ–∂–∏–º —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä–∞" (`template`):** –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Jinja2 –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.
3.  **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—É—é –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö:** –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `${VAR}` –¥–æ–ª–∂–Ω—ã –∑–∞–º–µ–Ω—è—Ç—å—Å—è –Ω–∞ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è –∫–∞–∫ –≤ –∫–æ–Ω—Ñ–∏–≥–µ, —Ç–∞–∫ –∏ –≤–Ω—É—Ç—Ä–∏ –ø–æ–¥–∫–ª—é—á–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤.
4.  **–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤:** –°–¥–µ–ª–∞—Ç—å –ø–æ–ª–µ `output_file` –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –∏ –¥–æ–±–∞–≤–∏—Ç—å "—É–º–Ω–æ–µ" –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—É—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.
5.  **–£–ø—Ä–æ—Å—Ç–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:** –£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∏ –±–æ–ª–µ–µ –Ω–µ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è –∏–∑ `settings`.
6.  **–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –∏ —Ç–µ—Å—Ç—ã:** –ü—Ä–∏–≤–µ—Å—Ç–∏ –≤—Å–µ —Å–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–æ–π.

### 2. –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ (`prompts.yml`)

–≠—Ç–æ —ç—Ç–∞–ª–æ–Ω–Ω—ã–π –ø—Ä–∏–º–µ—Ä, –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É—é—â–∏–π –≤—Å–µ –Ω–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.

```yaml
# 1. –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –≤—Å–µ–º –∞–≥–µ–Ω—Ç–∞–º
variables:
  project_name: "DocuScribe"
  rules_path: "includes/development-rules.md"
  architecture_doc: "F:/Projects/docuscribe/.gemini/ARCHITECTURE.md"

# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
settings:
  # output_dir –æ—Å—Ç–∞–µ—Ç—Å—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –ø—É—Ç–∏
  output_dir: "composed_prompts"

agents:
  # --- –ü—Ä–∏–º–µ—Ä 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ "–ü—Ä–æ—Å—Ç–æ–≥–æ —Å–±–æ—Ä—â–∏–∫–∞" ---
  code-reviewer:
    # output_file –Ω–µ —É–∫–∞–∑–∞–Ω, –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ "code-reviewer.md"
    variables:
      # –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
      project_name: "Prompt Scribe"

    # –ö–ª—é—á 'assembly' –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –ø—Ä–æ—Å—Ç–æ–π —Å–±–æ—Ä—â–∏–∫. –°–±–æ—Ä–∫–∞ –∏–¥–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ.
    assembly:
      - content: |
          –¢—ã ‚Äî —Å—Ç–∞—Ä—à–∏–π AI-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ `${project_name}`.
          –¢–≤–æ—è –≥–ª–∞–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ ‚Äî –ø—Ä–æ–≤–µ—Å—Ç–∏ —Ç—â–∞—Ç–µ–ª—å–Ω—ã–π –∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω—ã–π code review.

      - separator: "---"

      - h2: "üìú –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏" # –Ø–≤–Ω—ã–π —Ö–µ–ª–ø–µ—Ä –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞
      - include: rules_path # –í—Å—Ç–∞–≤–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑ —Ñ–∞–π–ª–∞ –ø–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π

      - separator: "---"

      - h2: "üìÑ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞"
      - include: architecture_doc

  # --- –ü—Ä–∏–º–µ—Ä 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞ Jinja2 ---
  advanced-report-generator:
    template: "report.jinja2" # –ö–ª—é—á 'template' –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ä–µ–∂–∏–º Jinja2
    output_file: "../custom_outputs/final_report.txt" # –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—É—Ç–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    variables:
      report_type: "–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–π"
      data_source: "includes/source-data.json" # jinja —Å–º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —ç—Ç–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π
```

### 3. –í—ã—Å–æ–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞

–î–∏–∞–≥—Ä–∞–º–º–∞ –Ω–∏–∂–µ –∏–ª–ª—é—Å—Ç—Ä–∏—Ä—É–µ—Ç –ª–æ–≥–∏–∫—É –≤—ã–±–æ—Ä–∞ –¥–≤–∏–∂–∫–∞ —Å–±–æ—Ä–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–≥–µ–Ω—Ç–∞.

```mermaid
graph TD
    A["Start: 'prompt-scribe compose'"] --> B{"–ó–∞–≥—Ä—É–∑–∫–∞ prompts.yml"};
    B --> C{"–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–≥–ª–æ–±–∞–ª—å–Ω—ã–µ + –∞–≥–µ–Ω—Ç–∞)"};
    C --> D{"–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –≤ 'agents'"};
    D --> E{"–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–∞ 'template' —É –∞–≥–µ–Ω—Ç–∞"};
    E -- "–î–∞" --> F["–†–µ–∂–∏–º Jinja2"];
    E -- "–ù–µ—Ç" --> G["–†–µ–∂–∏–º '–ü—Ä–æ—Å—Ç–æ–≥–æ —Å–±–æ—Ä—â–∏–∫–∞' (Assembly)"];
    
    F --> H{"1. –°–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö<br/>2. –û—Ç—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å Jinja2 —à–∞–±–ª–æ–Ω"};
    G --> I{"1. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —à–∞–≥–∏ –≤ 'assembly'<br/>2. –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—É—é –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫—É '${VAR}'"};
    
    H --> J{"–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—É—Ç—å –≤—ã–≤–æ–¥–∞ (–ª–æ–≥–∏–∫–∞ output_file)"};
    I --> J;
    J --> K["–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –≤ —Ñ–∞–π–ª"];
    K --> D;
```

### 4. –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

#### –®–∞–≥ 1: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–º–æ–¥—É–ª—å `composer.py`)

1.  **–ö–ª–∞—Å—Å `PromptComposer`:**
    *   –í –º–µ—Ç–æ–¥–µ `_load_config` –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∑–∞–≥—Ä—É–∑–∫—É YAML –≤ `self.config`.
    *   –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–µ—Ç–æ–¥ `_resolve_variables(agent_name: str) -> dict`:
        *   –û–Ω –¥–æ–ª–∂–µ–Ω —Å–ø–µ—Ä–≤–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `self.config.get('variables', {})`.
        *   –ó–∞—Ç–µ–º –∑–∞–≥—Ä—É–∂–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –∏–∑ `agent_config.get('variables', {})`.
        *   –û–±—ä–µ–¥–∏–Ω—è—Ç—å –∏—Ö, –ø—Ä–∏ —ç—Ç–æ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç–∞ –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.
        *   –í–æ–∑–≤—Ä–∞—â–∞—Ç—å –∏—Ç–æ–≥–æ–≤—ã–π —Å–ª–æ–≤–∞—Ä—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.

#### –®–∞–≥ 2: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è "–ü—Ä–æ—Å—Ç–æ–≥–æ —Å–±–æ—Ä—â–∏–∫–∞" (–º–æ–¥—É–ª—å `composer.py`)

1.  **–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ `_run_simple_assembly(agent_config: dict, variables: dict) -> str`:**
    *   –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ `parts = []` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —á–∞—Å—Ç–µ–π –ø—Ä–æ–º–ø—Ç–∞.
    *   –ò—Ç–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –ø–æ —Å–ø–∏—Å–∫—É —à–∞–≥–æ–≤ –≤ `agent_config['assembly']`.
    *   –î–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `match/case` –∏–ª–∏ `if/elif` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–∏–ø–∞ –¥–µ–π—Å—Ç–≤–∏—è (`content`, `include`, `separator`, `h1`-`h6`).
    *   **–õ–æ–≥–∏–∫–∞ `content`:**
        *   –í–∑—è—Ç—å —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.
        *   –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–π –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (—Å–º. –®–∞–≥ 3).
        *   –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `parts`.
    *   **–õ–æ–≥–∏–∫–∞ `include`:**
        *   –ü–æ–ª—É—á–∏—Ç—å –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `rules_path`).
        *   –í–∑—è—Ç—å –∏–∑ `variables` –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É.
        *   –ü—Ä–æ—á–∏—Ç–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞.
        *   –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–π –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏.
        *   –î–æ–±–∞–≤–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `parts`.
    *   **–õ–æ–≥–∏–∫–∞ `separator`:** –î–æ–±–∞–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"---"`) –≤ `parts`.
    *   **–õ–æ–≥–∏–∫–∞ `h1`-`h6`:** –î–æ–±–∞–≤–∏—Ç—å –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `f"## {value}"`) –≤ `parts`.
2.  **–°–±–æ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
    *   –ü–æ—Å–ª–µ —Ü–∏–∫–ª–∞ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ `parts` —Å –ø–æ–º–æ—â—å—é `"\n\n"` (–¥–≤–æ–π–Ω–æ–π –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –æ–¥–Ω–æ–π –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–∏ –º–µ–∂–¥—É –±–ª–æ–∫–∞–º–∏).
    *   –í–µ—Ä–Ω—É—Ç—å –∏—Ç–æ–≥–æ–≤—É—é —Å—Ç—Ä–æ–∫—É.

#### –®–∞–≥ 3: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–π –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö (–º–æ–¥—É–ª—å `composer.py` –∏–ª–∏ –Ω–æ–≤—ã–π `utils.py`)

1.  **–°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `substitute_variables(text: str, variables: dict, depth: int = 0) -> str`:**
    *   –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞—â–∏—Ç—É –æ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: –µ—Å–ª–∏ `depth > MAX_DEPTH` (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10), –≤—ã–±—Ä–æ—Å–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.
    *   –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `re.sub` —Å —Ñ—É–Ω–∫—Ü–∏–µ–π-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—Å–µ—Ö –≤—Ö–æ–∂–¥–µ–Ω–∏–π `${VAR}`.
    *   **–í —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ:**
        *   –ò–∑–≤–ª–µ—á—å –∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `VAR`.
        *   –ï—Å–ª–∏ `VAR` –µ—Å—Ç—å –≤ —Å–ª–æ–≤–∞—Ä–µ `variables`:
            *   –ü–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ.
            *   **–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É (–ø—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞), —Ç–æ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã–∑–≤–∞—Ç—å `substitute_variables` –¥–ª—è —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —ç—Ç–æ–≥–æ —Ñ–∞–π–ª–∞ —Å `depth + 1`.
            *   –í–µ—Ä–Ω—É—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.
        *   –ï—Å–ª–∏ `VAR` –Ω–µ—Ç –≤ —Å–ª–æ–≤–∞—Ä–µ `variables`, –≤–µ—Ä–Ω—É—Ç—å –ø—É—Å—Ç—É—é —Å—Ç—Ä–æ–∫—É `''`.

#### –®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `compose_agent` –∏ –ª–æ–≥–∏–∫–∏ Jinja2 (–º–æ–¥—É–ª—å `composer.py`)

1.  **–ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –º–µ—Ç–æ–¥ `compose_agent(self, agent_name: str)`:**
    *   –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∞–≥–µ–Ω—Ç–∞.
    *   –í—ã–∑–≤–∞—Ç—å `_resolve_variables(agent_name)` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Å–ª–æ–≤–∞—Ä—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.
    *   **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ –∫–ª—é—á `template`:**
        *   **–ï—Å–ª–∏ –¥–∞ (—Ä–µ–∂–∏–º Jinja2):**
            *   –ü–µ—Ä–µ–¥–∞—Ç—å –≤–µ—Å—å —Å–ª–æ–≤–∞—Ä—å `variables` –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤ `template.render()`. **–ù–∏–∫–∞–∫–æ–π —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏ —Å–±–æ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ.**
        *   **–ï—Å–ª–∏ –Ω–µ—Ç (–ü—Ä–æ—Å—Ç–æ–π —Å–±–æ—Ä—â–∏–∫):**
            *   –í—ã–∑–≤–∞—Ç—å `_run_simple_assembly(agent_config, variables)` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≥–æ—Ç–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞.
    *   **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É `output_file`:**
        *   –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—É—Ç—å –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∞–≤–∏–ª–∞–º, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –æ–±—Å—É–¥–∏–ª–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω–∏, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–±—Å–æ–ª—é—Ç–Ω–æ–≥–æ/–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø—É—Ç–∏).
    *   –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ñ–∞–π–ª.

#### –®–∞–≥ 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

1.  **–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `src/promptscribe/project_template/`:**
    *   –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å `prompts.yml`, —á—Ç–æ–±—ã –æ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ (—Å–º. —Å–µ–∫—Ü–∏—é 2 —ç—Ç–æ–≥–æ –ø–ª–∞–Ω–∞).
    *   –£–¥–∞–ª–∏—Ç—å –∏–∑ –Ω–µ–≥–æ `personas_dir`, `includes_dir`.
    *   –û–±–Ω–æ–≤–∏—Ç—å `master.jinja2`, —á—Ç–æ–±—ã –æ–Ω —Ä–∞–±–æ—Ç–∞–ª —Å –ø—Ä–æ—Å—Ç—ã–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º, –∞ –Ω–µ —Å–æ —Å–ª–æ–∂–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π `persona` –∏ `sections`.
2.  **–§–∞–π–ª `README.md`:**
    *   –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Ä–∞–∑–¥–µ–ª "Configuration", –æ–±—ä—è—Å–Ω—è—è –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏ –¥–≤—É–º—è —Ä–µ–∂–∏–º–∞–º–∏.
    *   –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã –≤ —Ä–∞–∑–¥–µ–ª–µ "Quick Start".

#### –®–∞–≥ 6: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ (–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `tests/`)

1.  –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã –¥–ª—è `PromptComposer`, —á—Ç–æ–±—ã –æ–Ω–∏ –ø—Ä–æ–≤–µ—Ä—è–ª–∏ –Ω–æ–≤—É—é –ª–æ–≥–∏–∫—É.
2.  –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è:
    *   –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö.
    *   –†–∞–±–æ—Ç—ã "–ü—Ä–æ—Å—Ç–æ–≥–æ —Å–±–æ—Ä—â–∏–∫–∞" —Å–æ –≤—Å–µ–º–∏ —Ç–∏–ø–∞–º–∏ —à–∞–≥–æ–≤ (`content`, `include` –∏ —Ç.–¥.).
    *   –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Ä–µ–∂–∏–º–∞ Jinja2 —Å –Ω–æ–≤—ã–º —Ñ–æ—Ä–º–∞—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
    *   –í—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –ª–æ–≥–∏–∫–∏ `output_file`.
    *   –°—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è –∑–∞—â–∏—Ç—ã –æ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.